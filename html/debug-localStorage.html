<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug sessionStorage - FRT</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 20px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .pool-item {
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .duplicate {
            border-color: #ef4444;
            background: #fef2f2;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .code {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß sessionStorage Debug Tool</h1>
            <p>Debug and clean up sessionStorage data for Fixed Ratio Trading</p>
        </div>
        
        <div class="section">
            <h2>üèä‚Äç‚ôÇÔ∏è Created Pools</h2>
            <div id="pools-section">
                <button class="btn btn-primary" onclick="loadPools()">üîç Load Pools</button>
                <button class="btn btn-warning" onclick="removeDuplicates()">üßπ Remove Duplicates</button>
                <button class="btn btn-danger" onclick="clearAllPools()">üóëÔ∏è Clear All Pools</button>
            </div>
            <div id="pools-display"></div>
        </div>
        
        <div class="section">
            <h2>ü™ô Created Tokens</h2>
            <div id="tokens-section">
                <button class="btn btn-primary" onclick="loadTokens()">üîç Load Tokens</button>
                <button class="btn btn-danger" onclick="clearAllTokens()">üóëÔ∏è Clear All Tokens</button>
            </div>
            <div id="tokens-display"></div>
        </div>
        
        <div class="section">
            <h2>üìä Raw Data</h2>
            <button class="btn btn-primary" onclick="showRawData()">üìã Show Raw sessionStorage Data</button>
            <div id="raw-data-display"></div>
        </div>
    </div>

    <script>
        function loadPools() {
            const poolsData = sessionStorage.getItem('createdPools');
            const display = document.getElementById('pools-display');
            
            if (!poolsData) {
                display.innerHTML = '<p>No pools found in sessionStorage</p>';
                return;
            }
            
            try {
                const pools = JSON.parse(poolsData);
                console.log('Loaded pools:', pools);
                
                let html = `<h3>Found ${pools.length} pools:</h3>`;
                
                // Check for duplicates
                const addressCounts = {};
                pools.forEach(pool => {
                    addressCounts[pool.address] = (addressCounts[pool.address] || 0) + 1;
                });
                
                pools.forEach((pool, index) => {
                    const isDuplicate = addressCounts[pool.address] > 1;
                    const duplicateClass = isDuplicate ? 'duplicate' : '';
                    
                    html += `
                        <div class="pool-item ${duplicateClass}">
                            <strong>Pool ${index + 1} ${isDuplicate ? '‚ö†Ô∏è DUPLICATE' : ''}</strong><br>
                            <strong>Address:</strong> ${pool.address}<br>
                            <strong>Tokens:</strong> ${pool.tokenASymbol}/${pool.tokenBSymbol} (${pool.tokenAName}/${pool.tokenBName})<br>
                            <strong>Ratio:</strong> ${pool.ratio}<br>
                            <strong>Created:</strong> ${pool.createdAt}<br>
                            <strong>Creator:</strong> ${pool.creator}<br>
                            ${pool.transactionSignature ? `<strong>Tx:</strong> ${pool.transactionSignature}<br>` : ''}
                            <button class="btn btn-danger" onclick="removePool(${index})">Remove This Pool</button>
                        </div>
                    `;
                });
                
                display.innerHTML = html;
                
                // Show duplicate summary
                const duplicateAddresses = Object.keys(addressCounts).filter(addr => addressCounts[addr] > 1);
                if (duplicateAddresses.length > 0) {
                    display.innerHTML = `
                        <div style="background: #fef2f2; border: 2px solid #ef4444; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <strong>‚ö†Ô∏è Duplicate Addresses Found:</strong><br>
                            ${duplicateAddresses.map(addr => `${addr} (${addressCounts[addr]} times)`).join('<br>')}
                        </div>
                    ` + display.innerHTML;
                }
                
            } catch (error) {
                display.innerHTML = `<p style="color: red;">Error parsing pools data: ${error.message}</p>`;
            }
        }
        
        function removeDuplicates() {
            const poolsData = sessionStorage.getItem('createdPools');
            if (!poolsData) {
                alert('No pools found');
                return;
            }
            
            try {
                const pools = JSON.parse(poolsData);
                const uniquePools = [];
                const seenAddresses = new Set();
                
                pools.forEach(pool => {
                    if (!seenAddresses.has(pool.address)) {
                        seenAddresses.add(pool.address);
                        uniquePools.push(pool);
                    }
                });
                
                sessionStorage.setItem('createdPools', JSON.stringify(uniquePools));
                alert(`Removed ${pools.length - uniquePools.length} duplicate pools. ${uniquePools.length} unique pools remaining.`);
                loadPools(); // Refresh display
                
            } catch (error) {
                alert('Error removing duplicates: ' + error.message);
            }
        }
        
        function removePool(index) {
            const poolsData = sessionStorage.getItem('createdPools');
            if (!poolsData) return;
            
            try {
                const pools = JSON.parse(poolsData);
                if (confirm(`Remove pool: ${pools[index].tokenASymbol}/${pools[index].tokenBSymbol}?`)) {
                    pools.splice(index, 1);
                    sessionStorage.setItem('createdPools', JSON.stringify(pools));
                    loadPools(); // Refresh display
                }
            } catch (error) {
                alert('Error removing pool: ' + error.message);
            }
        }
        
        function clearAllPools() {
            if (confirm('Are you sure you want to clear ALL pools? This cannot be undone.')) {
                sessionStorage.removeItem('createdPools');
                document.getElementById('pools-display').innerHTML = '<p>All pools cleared.</p>';
            }
        }
        
        function loadTokens() {
            const tokensData = sessionStorage.getItem('createdTokens');
            const display = document.getElementById('tokens-display');
            
            if (!tokensData) {
                display.innerHTML = '<p>No tokens found in sessionStorage</p>';
                return;
            }
            
            try {
                const tokens = JSON.parse(tokensData);
                let html = `<h3>Found ${tokens.length} tokens:</h3>`;
                
                tokens.forEach((token, index) => {
                    html += `
                        <div class="pool-item">
                            <strong>Token ${index + 1}</strong><br>
                            <strong>Symbol:</strong> ${token.symbol}<br>
                            <strong>Name:</strong> ${token.name}<br>
                            <strong>Mint:</strong> ${token.mint}<br>
                            <strong>Created:</strong> ${token.createdAt}<br>
                        </div>
                    `;
                });
                
                display.innerHTML = html;
                
            } catch (error) {
                display.innerHTML = `<p style="color: red;">Error parsing tokens data: ${error.message}</p>`;
            }
        }
        
        function clearAllTokens() {
            if (confirm('Are you sure you want to clear ALL tokens? This cannot be undone.')) {
                sessionStorage.removeItem('createdTokens');
                document.getElementById('tokens-display').innerHTML = '<p>All tokens cleared.</p>';
            }
        }
        
        function showRawData() {
            const display = document.getElementById('raw-data-display');
            const pools = sessionStorage.getItem('createdPools');
            const tokens = sessionStorage.getItem('createdTokens');
            
            let html = '<h3>Raw sessionStorage Data:</h3>';
            
            html += '<h4>createdPools:</h4>';
            html += `<div class="code">${pools || 'null'}</div>`;
            
            html += '<h4>createdTokens:</h4>';
            html += `<div class="code">${tokens || 'null'}</div>`;
            
            display.innerHTML = html;
        }
        
        // Auto-load on page load
        window.addEventListener('load', () => {
            loadPools();
            loadTokens();
        });
    </script>
</body>
</html> 